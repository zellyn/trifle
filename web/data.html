<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Management - Trifling</title>
    <link rel="stylesheet" href="/css/app.css">
    <style>
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 32px 24px;
        }

        .data-content {
            background: rgba(255, 255, 255, 0.85);
            border: 1px solid rgba(225, 228, 232, 0.5);
            border-radius: 8px;
            padding: 32px;
            margin-bottom: 24px;
        }

        .data-section {
            margin-bottom: 40px;
        }

        .data-section:last-child {
            margin-bottom: 0;
        }

        .data-section h2 {
            font-size: 24px;
            font-weight: 600;
            color: #1a1f36;
            margin-bottom: 8px;
        }

        .data-section p {
            color: #666;
            font-size: 14px;
            margin-bottom: 16px;
        }

        .export-list, .import-list {
            background: #f7f9fc;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 16px;
        }

        .export-item, .import-item {
            display: flex;
            align-items: flex-start;
            padding: 12px;
            margin-bottom: 8px;
            background: white;
            border-radius: 6px;
            border: 1px solid #e1e4e8;
        }

        .export-item:last-child, .import-item:last-child {
            margin-bottom: 0;
        }

        .export-item input[type="checkbox"] {
            margin-top: 4px;
            margin-right: 12px;
            cursor: pointer;
        }

        .import-item .item-info {
            width: 100%;
        }

        .item-info {
            flex: 1;
        }

        .item-name {
            font-weight: 600;
            color: #1a1f36;
            margin-bottom: 4px;
        }

        .item-meta {
            font-size: 12px;
            color: #666;
        }

        .action-buttons {
            display: flex;
            gap: 12px;
            margin-bottom: 16px;
        }

        .import-actions {
            margin-top: 8px;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .radio-group {
            display: flex;
            gap: 16px;
        }

        .radio-group label {
            display: flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
            font-size: 14px;
            color: #333;
        }

        .comparison {
            background: #f7f9fc;
            padding: 12px;
            border-radius: 6px;
            margin-top: 8px;
            font-size: 13px;
        }

        .comparison-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 4px;
        }

        .comparison-label {
            color: #666;
            font-weight: 500;
        }

        .comparison-value {
            color: #1a1f36;
        }

        .recommended {
            color: #667eea;
            font-size: 12px;
            margin-top: 8px;
            font-weight: 500;
        }

        .hidden {
            display: none;
        }

        .file-input-wrapper input[type="file"] {
            display: none;
        }

        .bulk-actions {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }

        .bulk-action-btn {
            background: #f7f9fc;
            color: #667eea;
            border: 1px solid #e1e4e8;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .bulk-action-btn:hover {
            background: #e1e4e8;
            border-color: #667eea;
        }
    </style>
</head>
<body>
    <!-- Notification container for dismissible messages -->
    <div id="notificationContainer" class="notification-container"></div>

    <div class="header">
        <h1><a href="/" class="logo-link">Trifling</a></h1>
    </div>

    <div class="container">
        <div class="data-content">
            <!-- Export Section -->
            <div class="data-section">
                <h2>Export Your Data</h2>
                <p>Download a backup of your profile and trifles as a JSON file.</p>

                <div id="exportList" class="export-list">
                    <p style="color: #999; text-align: center;">Loading...</p>
                </div>

                <div class="bulk-actions" id="exportBulkActions" style="display: none;">
                    <button class="bulk-action-btn" id="selectAllExport">Select All</button>
                    <button class="bulk-action-btn" id="selectNoneExport">Select None</button>
                </div>

                <button class="btn btn-primary" id="exportBtn" disabled>Export Selected</button>
            </div>

            <!-- Import Section -->
            <div class="data-section" style="border-top: 2px solid #e1e4e8; padding-top: 40px;">
                <h2>Import Data</h2>
                <p>Restore data from a backup file.</p>

                <div class="file-input-wrapper">
                    <button class="btn btn-secondary" id="chooseFileBtn">Choose Backup File</button>
                    <input type="file" id="importFile" accept=".json">
                </div>

                <!-- Review/Conflict Section (hidden until file selected) -->
                <div id="reviewSection" class="hidden" style="margin-top: 24px;">
                    <h3 style="font-size: 18px; font-weight: 600; color: #1a1f36; margin-bottom: 16px;">Review Import</h3>

                    <div id="importList" class="import-list">
                        <!-- Items will be populated here -->
                    </div>

                    <div class="bulk-actions" id="importBulkActions">
                        <button class="bulk-action-btn" id="importAll">Import All</button>
                        <button class="bulk-action-btn" id="skipAll">Skip All</button>
                        <button class="bulk-action-btn" id="useRecommendations">Use Recommendations</button>
                    </div>

                    <div class="action-buttons">
                        <button class="btn btn-cancel" id="cancelImportBtn">Cancel</button>
                        <button class="btn btn-primary" id="importBtn">Import</button>
                    </div>
                </div>
            </div>
        </div>

        <div style="text-align: center; margin-top: 24px;">
            <a href="/profile.html" style="color: #667eea; text-decoration: none;">‚Üê Back to Profile</a>
        </div>
    </div>

    <script type="module" src="/js/data.js"></script>
    <script>
        // Register service worker for offline support
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then((registration) => {
                        console.log('Service Worker registered:', registration);
                    })
                    .catch((error) => {
                        console.error('Service Worker registration failed:', error);
                    });
            });
        }
    </script>
</body>
</html>
